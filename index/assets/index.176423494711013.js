import{d as z,g as Y,I as Z,k as ee,m as te,r as s,a4 as V,o as m,a as k,h as t,w as a,a5 as b,f as _,F as ae,e as le,A as g,a9 as h,i as n,b as y,y as w,t as p,z as oe,O as S,N as F,aa as O}from"./index.1764234947110.js";import{l as re,c as ne,d as se}from"./oper.1764234947110.js";const de={class:"system-user-container app-container"},ue={class:"card-header"},ie={class:"dialog-footer"},me=z({name:"Operlog"}),he=z({...me,setup(pe){const{proxy:D}=Y(),B=Z(null),e=ee({loading:!0,total:0,tableData:[],ids:[],single:!0,multiple:!0,title:"",open:!1,showOtherSearch:!1,modelForm:{},methodOptions:{},expire_time:[],queryParams:{page:1,pageSize:10,start_time:void 0,end_time:void 0,search:void 0,request_modular:void 0,request_path:void 0,businessType:void 0,request_ip:void 0,request_method:void 0}}),u=()=>{e.loading=!0,re(e.queryParams).then(r=>{e.tableData=r.data.data,e.total=r.data.total,e.loading=!1})},I=()=>{e.queryParams.search=void 0,e.queryParams.request_modular=void 0,e.queryParams.request_path=void 0,e.queryParams.request_ip=void 0,e.queryParams.request_method=void 0,e.expire_time=[],e.queryParams.start_time=void 0,e.queryParams.end_time=void 0,u()},T=()=>{S({message:"是否确认清空所有操作日志数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return ne()}).then(()=>{u(),F.success("清空成功")})},U=r=>{const l=r.id||e.ids;S({message:'是否确认删除日志编号为"'+l+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return se(l).then(()=>{u(),F.success("删除成功")})})},E=r=>{e.open=!0,e.modelForm=r},v=()=>{e.showOtherSearch=!e.showOtherSearch,window.dispatchEvent(new Event("resize"))},K=r=>{e.queryParams.pageSize=r,u()},N=r=>{e.queryParams.page=r,u()},M=r=>{e.ids=r.map(l=>l.id),e.single=r.length!=1,e.multiple=!r.length},R=()=>{const r=e.expire_time;r&&r.length===2?(e.queryParams.start_time=O(r[0]),e.queryParams.end_time=O(r[1])):(e.queryParams.start_time=void 0,e.queryParams.end_time=void 0)};return te(()=>{u(),D.getDicts("sys_method_api").then(r=>{e.methodOptions=r.data.data})}),(r,l)=>{const q=s("el-input"),d=s("el-form-item"),j=s("el-option"),A=s("el-select"),Q=s("el-date-picker"),c=s("el-button"),x=s("el-form"),P=s("el-card"),i=s("el-table-column"),$=s("el-tag"),L=s("el-table"),G=s("el-divider"),H=s("el-pagination"),f=s("el-col"),J=s("el-row"),W=s("el-dialog"),C=V("auth"),X=V("loading");return m(),k("div",de,[t(P,{shadow:"always"},{default:a(()=>[t(x,{model:e.queryParams,ref:"queryForm",inline:!0},{default:a(()=>[t(d,{label:"关键词",prop:"search"},{default:a(()=>[t(q,{size:"default",placeholder:"请输入关键词模糊查询",clearable:"",onKeyup:b(u,["enter"]),style:{width:"180px"},modelValue:e.queryParams.search,"onUpdate:modelValue":l[0]||(l[0]=o=>e.queryParams.search=o)},null,8,["modelValue"])]),_:1}),t(d,{label:"请求地址",prop:"request_modular"},{default:a(()=>[t(q,{placeholder:"请输入操作模块模糊查询",clearable:"",onKeyup:b(u,["enter"]),style:{width:"180px"},modelValue:e.queryParams.request_modular,"onUpdate:modelValue":l[1]||(l[1]=o=>e.queryParams.request_modular=o)},null,8,["modelValue"])]),_:1}),t(d,{label:"操作模块",prop:"request_path"},{default:a(()=>[t(q,{placeholder:"请输入请求地址模糊查询",clearable:"",onKeyup:b(u,["enter"]),style:{width:"180px"},modelValue:e.queryParams.request_path,"onUpdate:modelValue":l[2]||(l[2]=o=>e.queryParams.request_path=o)},null,8,["modelValue"])]),_:1}),e.showOtherSearch?(m(),_(d,{key:0,label:"请求方法",prop:"businessType"},{default:a(()=>[t(A,{modelValue:e.queryParams.request_method,"onUpdate:modelValue":l[3]||(l[3]=o=>e.queryParams.request_method=o),placeholder:"请求方法",clearable:"",style:{width:"180px"}},{default:a(()=>[(m(!0),k(ae,null,le(e.methodOptions,o=>(m(),_(j,{key:o.dict_value,label:o.dict_label,value:o.dict_value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),e.showOtherSearch?(m(),_(d,{key:1,label:"IP地址",prop:"request_ip"},{default:a(()=>[t(q,{placeholder:"请输入IP地址模糊查询",clearable:"",onKeyup:b(u,["enter"]),style:{width:"180px"},modelValue:e.queryParams.request_ip,"onUpdate:modelValue":l[4]||(l[4]=o=>e.queryParams.request_ip=o)},null,8,["modelValue"])]),_:1})):g("",!0),e.showOtherSearch?(m(),_(d,{key:2,label:"操作时间",prop:"expire_time"},{default:a(()=>[t(Q,{modelValue:e.expire_time,"onUpdate:modelValue":l[5]||(l[5]=o=>e.expire_time=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:R},null,8,["modelValue"])]),_:1})):g("",!0),t(d,null,{default:a(()=>[t(c,{type:"primary",plain:"",onClick:u},{default:a(()=>[t(h,{name:"elementSearch"}),l[8]||(l[8]=n(" 搜索 "))]),_:1}),t(c,{onClick:I},{default:a(()=>[t(h,{name:"elementRefresh"}),l[9]||(l[9]=n(" 重置 "))]),_:1}),e.showOtherSearch?g("",!0):(m(),_(c,{key:0,onClick:v},{default:a(()=>[t(h,{name:"elementArrowDown"}),l[10]||(l[10]=n(" 展开 "))]),_:1})),e.showOtherSearch?(m(),_(c,{key:1,onClick:v},{default:a(()=>[t(h,{name:"elementArrowUp"}),l[11]||(l[11]=n(" 收起 "))]),_:1})):g("",!0)]),_:1})]),_:1},8,["model"])]),_:1}),t(P,{class:"box-card"},{header:a(()=>[y("div",ue,[l[14]||(l[14]=y("span",{class:"card-header-text"},"操作日志",-1)),y("div",null,[w((m(),_(c,{type:"danger",plain:"",disabled:e.multiple,onClick:U},{default:a(()=>[t(h,{name:"elementDelete"}),l[12]||(l[12]=n(" 删除 "))]),_:1},8,["disabled"])),[[C,"log:operation:delete"]]),w((m(),_(c,{type:"danger",plain:"",onClick:T},{default:a(()=>[t(h,{name:"elementDelete"}),l[13]||(l[13]=n(" 清空 "))]),_:1})),[[C,"log:operation:clean"]])])])]),default:a(()=>[w((m(),_(L,{data:e.tableData,onSelectionChange:M},{default:a(()=>[t(i,{type:"selection",width:"55",align:"center"}),t(i,{label:"日志编号",align:"center",width:"120",prop:"id"}),t(i,{label:"操作模块",align:"center",prop:"request_modular"}),t(i,{label:"请求地址",align:"center",prop:"request_path"}),t(i,{label:"请求方法",align:"center",prop:"request_method"}),t(i,{label:"操作人员",align:"center",prop:"creator_name"}),t(i,{label:"请求浏览器",align:"center",prop:"request_browser","show-overflow-tooltip":!0}),t(i,{label:"响应码",align:"center",prop:"response_code"},{default:a(o=>[t($,{type:o.row.response_code==="200"?"success":"default"},{default:a(()=>[n(p(o.row.response_code),1)]),_:2},1032,["type"])]),_:1}),t(i,{label:"操作日期",align:"center",prop:"create_datetime"}),t(i,{label:"返回信息",align:"center",prop:"json_result","show-overflow-tooltip":!0}),t(i,{label:"操作",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:a(o=>[t(c,{text:"",type:"primary",onClick:_e=>E(o.row)},{default:a(()=>[t(h,{name:"elementView"}),l[15]||(l[15]=n(" 详细 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,e.loading]]),w(y("div",null,[t(G),t(H,{background:"",total:e.total,"current-page":e.queryParams.page,"page-sizes":[10,20,30,40],"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:N},null,8,["total","current-page","page-size"])],512),[[oe,e.total>0]])]),_:1}),t(W,{title:"操作日志详细",modelValue:e.open,"onUpdate:modelValue":l[7]||(l[7]=o=>e.open=o),width:"700px",center:"","append-to-body":""},{footer:a(()=>[y("span",ie,[t(c,{onClick:l[6]||(l[6]=o=>e.open=!1)},{default:a(()=>l[16]||(l[16]=[n("关 闭")])),_:1})])]),default:a(()=>[t(x,{ref_key:"ruleFormRef",ref:B,model:e.modelForm,"label-width":"100px"},{default:a(()=>[t(J,null,{default:a(()=>[t(f,{span:12},{default:a(()=>[t(d,{label:"操作模块："},{default:a(()=>[n(p(e.modelForm.request_modular),1)]),_:1}),t(d,{label:"登录信息："},{default:a(()=>[n(p(e.modelForm.creator_name)+" / "+p(e.modelForm.request_ip)+" / "+p(e.modelForm.request_browser),1)]),_:1})]),_:1}),t(f,{span:12},{default:a(()=>[t(d,{label:"请求地址："},{default:a(()=>[n(p(e.modelForm.request_path),1)]),_:1})]),_:1}),t(f,{span:24},{default:a(()=>[t(d,{label:"操作方法："},{default:a(()=>[n(p(e.modelForm.request_method),1)]),_:1})]),_:1}),t(f,{span:24},{default:a(()=>[t(d,{label:"请求参数："},{default:a(()=>[n(p(e.modelForm.request_body),1)]),_:1})]),_:1}),t(f,{span:12},{default:a(()=>[t(d,{label:"操作状态："},{default:a(()=>[n(p(e.modelForm.response_code),1)]),_:1})]),_:1}),t(f,{span:12},{default:a(()=>[t(d,{label:"操作时间："},{default:a(()=>[n(p(e.modelForm.create_datetime),1)]),_:1})]),_:1}),t(f,{span:24},{default:a(()=>[t(d,{label:"返回信息："},{default:a(()=>[n(p(e.modelForm.json_result),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{he as default};
