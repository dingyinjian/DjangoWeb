import{u as L,a as O,b as J}from"./link.17642349471102.js";import{d as P,I as d,g as W,k as z,r as n,a4 as T,o as p,a as _,h as a,w as i,y as j,i as f,t as H,b as w,F as K,e as Q,a0 as x,a8 as X,N as c,f as Y,_ as Z}from"./index.1764234947110.js";const $={class:"system-menu-container"},ee={style:{"font-size":"large"}},le={class:"dialog-footer"},te=["src"],oe=P({__name:"editModule",props:{title:{type:String,default:()=>""}},emits:["ok"],setup(k,{expose:D,emit:S}){const u=d([]),v=S,{proxy:y}=W(),F=d(null);d("");const b=d(""),m=d(!1);d([]);const e=z({isShowDialog:!1,loading:!1,ruleForm:{id:0,title:"",url:"",category:"",images:[""],description:""},enableOptions:[{dict_value:"0",dict_label:"需要"},{dict_value:"1",dict_label:"不需要"}],categoryGroups:[],ruleRules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],url:[{required:!0,message:"链接不能为空",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"blur"}]}}),C=t=>{e.ruleForm=JSON.parse(JSON.stringify(t)),t.images&&t.images.length>0&&(u.value=t.images.map((l,o)=>({name:l.split("/").pop()||"image",url:"http://36.133.79.38:8002"+l,uid:o+l.split("/").pop()}))),e.isShowDialog=!0,e.loading=!1,y.getDicts("link_category").then(l=>{e.categoryGroups=l.data.data})},g=t=>{y.mittBus.emit("onEditApiModule",t),e.isShowDialog=!1},U=()=>{g()},I=async t=>{console.log(t);const l=t.file;if(!l||!l.type.startsWith("image/")){c.warning("请选择图片文件");return}try{e.loading=!0;const o=await L(l);u.value.push({name:o.original_name,url:"http://36.133.79.38:8002"+o.url,uid:o.id}),c.success("图片上传成功")}catch(o){console.log(o),c.error("图片上传失败，请重试")}finally{e.loading=!1}};function N(t,l){const o=u.value.findIndex(s=>s.uid===t.uid);o>-1&&u.value.splice(o,1)}function B(t){b.value=t.url,m.value=!0}const M=()=>{const t=x(F);t&&t.validate(l=>{if(console.log(u.value),l){const o={title:e.ruleForm.title,url:e.ruleForm.url,category:e.ruleForm.category,description:e.ruleForm.description,images:u.value.map(s=>s.url.replace(/^https?:\/\/[^\/]+/,"")),id:e.ruleForm.id};e.ruleForm.id&&e.ruleForm.id!==0?O(o).then(s=>{c.success("修改成功"),v("ok"),g(e.ruleForm)}).catch(()=>{e.loading=!1}):J(o).then(s=>{c.success("新增成功"),v("ok"),g(e.ruleForm)}).catch(()=>{e.loading=!1})}})};return D({openDialog:C}),(t,l)=>{const o=n("el-input"),s=n("el-form-item"),R=n("el-option"),q=n("el-select"),E=n("el-upload"),A=n("el-form"),h=n("el-button"),V=n("el-dialog"),G=T("drag");return p(),_("div",$,[a(V,{modelValue:e.isShowDialog,"onUpdate:modelValue":l[4]||(l[4]=r=>e.isShowDialog=r),width:"769px",center:""},{header:i(()=>[j((p(),_("div",ee,[f(H(k.title),1)])),[[G,[".app-container .el-dialog",".app-container .el-dialog__header"]]])]),footer:i(()=>[w("span",le,[a(h,{onClick:U},{default:i(()=>l[6]||(l[6]=[f("取 消")])),_:1}),a(h,{type:"primary",onClick:M,loading:e.loading},{default:i(()=>l[7]||(l[7]=[f("编 辑")])),_:1},8,["loading"])])]),default:i(()=>[a(A,{model:e.ruleForm,rules:e.ruleRules,ref_key:"ruleFormRef",ref:F,"label-width":"80px"},{default:i(()=>[a(s,{label:"标题",prop:"title"},{default:i(()=>[a(o,{modelValue:e.ruleForm.title,"onUpdate:modelValue":l[0]||(l[0]=r=>e.ruleForm.title=r),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),a(s,{label:"链接地址",prop:"url"},{default:i(()=>[a(o,{modelValue:e.ruleForm.url,"onUpdate:modelValue":l[1]||(l[1]=r=>e.ruleForm.url=r),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1}),a(s,{label:"分类",prop:"category"},{default:i(()=>[a(q,{modelValue:e.ruleForm.category,"onUpdate:modelValue":l[2]||(l[2]=r=>e.ruleForm.category=r),placeholder:"请输入分类",filterable:"",clearable:"","allow-create":"",style:{width:"100%"}},{default:i(()=>[(p(!0),_(K,null,Q(e.categoryGroups,r=>(p(),Y(R,{key:r.dict_value,label:r.dict_label,value:r.dict_value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"简介",prop:"description"},{default:i(()=>[a(o,{type:"textarea",modelValue:e.ruleForm.description,"onUpdate:modelValue":l[3]||(l[3]=r=>e.ruleForm.description=r)},null,8,["modelValue"])]),_:1}),a(s,{label:"封面图"},{default:i(()=>[a(E,{"list-type":"picture-card","file-list":u.value,"on-preview":B,"on-remove":N,"http-request":I},{default:i(()=>[a(x(X))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(V,{modelValue:m.value,"onUpdate:modelValue":l[5]||(l[5]=r=>m.value=r)},{default:i(()=>[w("img",{width:"100%",src:b.value,alt:""},null,8,te)]),_:1},8,["modelValue"])])}}});const ie=Z(oe,[["__scopeId","data-v-6c494b3c"]]);export{ie as default};
