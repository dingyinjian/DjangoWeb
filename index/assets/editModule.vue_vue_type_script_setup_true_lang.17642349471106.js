import{u as G,a as H,b as K}from"./job.1764234947110.js";import Q from"./cronExpression.1764234947110.js";import{d as X,g as Y,I as Z,k as h,r as a,a4 as ee,o as i,a as m,h as o,w as r,y as le,i as d,t as oe,b as D,f as p,F as U,e as S,A as N,a0 as te,N as f}from"./index.1764234947110.js";const re="/assets/cronexpress.1764234947110.png",ae={class:"system-job-container"},ne={style:{"font-size":"large"}},se={class:"dialog-footer"},me=X({__name:"editModule",props:{title:{type:String,default:()=>""}},setup(q,{expose:L}){const{proxy:J}=Y(),b=Z(null),e=h({isShowDialog:!1,loading:!1,ruleForm:{id:0,name:"",kwargs:"",type:0,crontab:"",task:"",one_off:!1,enabled:!1,description:"",interval:{}},interval:{every:null,period:null},taskList:[],ruleRules:{name:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],task:[{required:!0,message:"请输入celery任务方法",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"blur"}]},intervalList:[{id:"days",name:"天"},{id:"hours",name:"小时"},{id:"minutes",name:"分钟"},{id:"seconds",name:"秒"},{id:"microseconds",name:"微秒"}],cronPopover:!1,isDisabled:!1}),B=n=>{if(typeof n!="string")return!1;e.ruleForm.crontab=n},v=n=>{e.cronPopover=n},P=()=>{K().then(n=>{e.taskList=n.data.data})},j=n=>{P(),e.ruleForm=JSON.parse(JSON.stringify(n)),e.ruleForm.type==0&&(e.interval=e.ruleForm.interval),e.isShowDialog=!0,e.loading=!1,e.ruleForm.id>0&&(e.isDisabled=!0)},_=n=>{J.mittBus.emit("onEditJobModule",n),e.isShowDialog=!1,e.interval={every:null,period:null},e.isDisabled=!1},E=()=>{_()},R=()=>{const n=te(b);n&&n.validate(l=>{if(e.ruleForm.type===1&&e.ruleForm.crontab==""){e.loading=!1,f.warning("执行时间不能为空");return}if(e.ruleForm.type===0&&(e.interval.every==null||e.interval.every==""||e.interval.period==null||e.interval.period=="")){e.loading=!1,f.warning("执行时间不能为空");return}l&&(e.ruleForm={...e.ruleForm,interval:{period:e.interval.period,every:e.interval.every}},e.loading=!0,e.ruleForm.id!=null&&e.ruleForm.id!=0?G(e.ruleForm).then(u=>{f.success("修改成功"),e.loading=!1,_(e.ruleForm)}):(e.ruleForm.kwargs&&(e.ruleForm.kwargs=JSON.parse(e.ruleForm.kwargs)),H(e.ruleForm).then(u=>{f.success("新增成功"),e.loading=!1,_(e.ruleForm)})))})};return L({openDialog:j}),(n,l)=>{const u=a("el-input"),s=a("el-form-item"),y=a("question-filled"),c=a("el-icon"),F=a("el-tooltip"),V=a("el-radio-button"),M=a("el-radio-group"),O=a("el-input-number"),k=a("el-option"),w=a("el-select"),T=a("el-row"),z=a("Clock"),g=a("el-button"),x=a("el-alert"),I=a("el-drawer"),C=a("el-switch"),$=a("el-form"),A=a("el-dialog"),W=ee("drag");return i(),m("div",ae,[o(A,{modelValue:e.isShowDialog,"onUpdate:modelValue":l[13]||(l[13]=t=>e.isShowDialog=t),width:"769px",center:""},{header:r(()=>[le((i(),m("div",ne,[d(oe(q.title),1)])),[[W,[".system-job-container .el-dialog",".system-job-container .el-dialog__header"]]])]),footer:r(()=>[D("span",se,[o(g,{onClick:E},{default:r(()=>l[19]||(l[19]=[d("取 消")])),_:1}),o(g,{type:"primary",onClick:R,loading:e.loading},{default:r(()=>l[20]||(l[20]=[d("编 辑")])),_:1},8,["loading"])])]),default:r(()=>[o($,{model:e.ruleForm,rules:e.ruleRules,ref_key:"ruleFormRef",ref:b,"label-width":"100px"},{default:r(()=>[o(s,{label:"任务名称：",prop:"name"},{default:r(()=>[o(u,{modelValue:e.ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.ruleForm.name=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),o(s,{label:"任务类型：",prop:"type"},{default:r(()=>[o(F,{effect:"dark",content:"不支持编辑任务类型",placement:"top-start",style:{display:"flex","align-items":"center"}},{default:r(()=>[o(c,null,{default:r(()=>[o(y)]),_:1})]),_:1}),o(M,{modelValue:e.ruleForm.type,"onUpdate:modelValue":l[1]||(l[1]=t=>e.ruleForm.type=t)},{default:r(()=>[o(V,{label:0,disabled:e.isDisabled},{default:r(()=>l[14]||(l[14]=[d("间隔任务")])),_:1},8,["disabled"]),o(V,{label:1,disabled:e.isDisabled},{default:r(()=>l[15]||(l[15]=[d("周期任务")])),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),e.ruleForm.type==0?(i(),p(s,{key:0,label:"执行时间：",class:"is-required"},{default:r(()=>[o(T,null,{default:r(()=>[l[16]||(l[16]=d(" 每隔 ")),o(O,{modelValue:e.interval.every,"onUpdate:modelValue":l[2]||(l[2]=t=>e.interval.every=t),min:0,style:{margin:"0 5px 0 5px"}},null,8,["modelValue"]),o(w,{modelValue:e.interval.period,"onUpdate:modelValue":l[3]||(l[3]=t=>e.interval.period=t),style:{width:"150px"}},{default:r(()=>[(i(!0),m(U,null,S(e.intervalList,t=>(i(),p(k,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):N("",!0),e.ruleForm.type==1?(i(),p(s,{key:1,label:"执行时间：",prop:"crontab",class:"is-required"},{default:r(()=>[o(u,{modelValue:e.ruleForm.crontab,"onUpdate:modelValue":l[5]||(l[5]=t=>e.ruleForm.crontab=t),placeholder:"* * * * *"},{append:r(()=>[o(g,{type:"primary",onClick:l[4]||(l[4]=t=>v(!0))},{default:r(()=>[l[17]||(l[17]=d("生成表达式 ")),o(c,null,{default:r(()=>[o(z)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(x,{type:"info"},{default:r(()=>l[18]||(l[18]=[D("img",{src:re,style:{width:"100%"}},null,-1)])),_:1}),o(I,{modelValue:e.cronPopover,"onUpdate:modelValue":l[7]||(l[7]=t=>e.cronPopover=t),title:"cron表达式辅助工具",size:"40%","show-close":!1},{default:r(()=>[o(Q,{onChange:B,onClose:l[6]||(l[6]=t=>v(!1)),"max-height":"400px",i18n:"cn"})]),_:1},8,["modelValue"])]),_:1})):N("",!0),o(s,{label:"执行方法：",prop:"task"},{default:r(()=>[o(w,{modelValue:e.ruleForm.task,"onUpdate:modelValue":l[8]||(l[8]=t=>e.ruleForm.task=t),placeholder:"请输入或选择","allow-create":"",filterable:"",clearable:"",style:{width:"100%"}},{default:r(()=>[(i(!0),m(U,null,S(e.taskList,t=>(i(),p(k,{key:t.label,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(x,{title:"Celery任务调用示例：app_crontab.tasks.cron_job_add",type:"info","show-icon":""})]),_:1}),o(s,{label:"任务参数：",prop:"kwargs"},{default:r(()=>[o(F,{effect:"dark",content:'参数若为空则填置空,需要传递参数则直接在数组写值即可：如{"x": 5, "y": 6}',placement:"top-start",style:{display:"flex","align-items":"center"}},{default:r(()=>[o(c,null,{default:r(()=>[o(y)]),_:1})]),_:1}),o(u,{modelValue:e.ruleForm.kwargs,"onUpdate:modelValue":l[9]||(l[9]=t=>e.ruleForm.kwargs=t),placeholder:"请输入任务参数",style:{flex:"1"}},null,8,["modelValue"])]),_:1}),o(s,{label:"一次性任务：",prop:"one_off"},{default:r(()=>[o(C,{modelValue:e.ruleForm.one_off,"onUpdate:modelValue":l[10]||(l[10]=t=>e.ruleForm.one_off=t),"active-text":"是","inactive-text":"否","active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),_:1}),o(s,{label:"状态：",prop:"enabled"},{default:r(()=>[o(C,{modelValue:e.ruleForm.enabled,"onUpdate:modelValue":l[11]||(l[11]=t=>e.ruleForm.enabled=t),"active-text":"正常","inactive-text":"停止","active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),_:1}),o(s,{label:"备注：",prop:"description"},{default:r(()=>[o(u,{modelValue:e.ruleForm.description,"onUpdate:modelValue":l[12]||(l[12]=t=>e.ruleForm.description=t),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{me as _};
