import{d as Oe,g as Ne,I as K,k as Ke,m as Ae,r as s,a4 as D,o as f,a as A,h as o,w as n,a5 as Pe,F as E,e as R,i as u,b as c,y,f as b,t as J,a0 as m,aa as Ue,z as X,N as w,O as Y,K as Z}from"./index.1764234947110.js";import{l as qe,u as I,a as ee,d as We,b as De}from"./role.1764234947110.js";import{b as Ee}from"./menu.1764234947110.js";import{b as Re,c as Ie}from"./api.1764234947110.js";import{d as Le}from"./dept.1764234947110.js";const Te={class:"app-container"},Be={class:"card-header"},ze={class:"dialog-footer"},Me={class:"dialog-footer"},Xe=Oe({__name:"index",setup(je){const{proxy:le}=Ne(),L=K(null),V=K(null),v=K(null),k=K(null),l=Ke({activeName:"first",loading:!0,bunLoading:!1,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],apiOptions:[],menuCheckedKeys:[],apiCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,apiExpand:!1,apiNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{page:1,pageSize:10,search:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],roleForm:{},rules:{role_name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],role_key:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],sort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),O=()=>{l.menuExpand=!1,l.menuNodeAll=!1,l.apiExpand=!1,l.apiNodeAll=!1,l.deptExpand=!0,l.deptNodeAll=!1,l.roleForm={id:void 0,role_name:void 0,role_key:void 0,sort:0,status:"0",menu:[],api:[],dept:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},l.roleForm={}},te=()=>{l.queryParams.page=1,l.queryParams.pageSize=10,l.queryParams.search="",l.queryParams.status="",x()},h=()=>{l.loading=!0,qe(l.queryParams).then(a=>{l.roleList=a.data.data,l.total=a.data.total,l.loading=!1})},oe=a=>{l.queryParams.pageSize=a,x()},ae=a=>{l.queryParams.page=a,x()},ne=()=>{l.roleForm.id!=null&&(l.roleForm.dept=re(),I(l.roleForm).then(()=>{w.success("修改成功"),l.openDataScope=!1,h()}))},re=()=>{const a=m(k);let e=a.getCheckedKeys(),d=a.getHalfCheckedKeys();return e.unshift.apply(e,d),e},x=()=>{l.queryParams.page=1,h()},T=()=>{l.menuOptions.length==0&&Ee().then(a=>{l.menuOptions=a.data})},B=()=>{Ie({}).then(a=>{const e=a.data.data;l.apiOptions=de(e)})},de=a=>{const e=new Object;a&&a.map(r=>{r.onlyId="p:"+r.path+"m:"+r.method,Object.prototype.hasOwnProperty.call(e,r.api_group)?e[r.api_group].push(r):Object.assign(e,{[r.api_group]:[r]})});const d=[];for(const r in e){const p={onlyId:r,description:r+"组",children:e[r]};d.push(p)}return d},se=a=>{l.ids=a.map(e=>e.id),l.single=a.length!=1,l.multiple=!a.length},ue=a=>{let e=a.status==="0"?"启用":"停用";Y({closeOnClickModal:!1,closeOnPressEscape:!1,title:"警告",message:'确认要"'+e+'""'+a.role_name+'"角色吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return I(a)}).then(()=>{w.success(e+"成功")}).catch(function(){a.status=a.status==="0"?"1":"0"})},pe=a=>{O(),fe(),ee(a.id).then(e=>{l.roleForm=e.data.data;const d=l.roleForm.dept;l.openDataScope=!0,Z(()=>{m(k).setCheckedKeys(d)}),l.title="分配数据权限"})},ie=()=>{O(),T(),B(),l.open=!0,l.title="添加角色"},me=a=>{const e=a.id;T(),B(),ee(e).then(d=>{l.roleForm=d.data.data,l.open=!0,l.title="修改角色",Z(()=>{l.menuCheckedKeys=l.roleForm.menu,m(V).setCheckedKeys(l.menuCheckedKeys),Re(e).then(p=>{let F=[];p.data&&p.data.map(i=>{F.push("p:"+i.path+"m:"+i.method)}),m(v).setCheckedKeys(F)})})}),l.bunLoading=!1},z=a=>{const e=a.id||l.ids;Y({message:'是否确认删除角色编号为"'+e+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return We(e)}).then(()=>{h(),w.success("删除成功"),l.bunLoading=!1})},fe=()=>Le().then(a=>{l.deptOptions=a.data}),ce=()=>{const a=m(L);a&&a.validate(e=>{e&&(l.bunLoading=!0,l.roleForm!=null&&l.roleForm.id!=null?(l.roleForm.menu=M(),l.roleForm.api=j(),I(l.roleForm).then(()=>{w.success("修改成功"),l.bunLoading=!1,l.open=!1,h()})):(l.roleForm.menu=M(),l.roleForm.api=j(),De(l.roleForm).then(()=>{w.success("新增成功"),l.bunLoading=!1,l.open=!1,h()})))})},ge=()=>{l.open=!1,O()},M=()=>{const a=m(V);if(!a)return;let e=a.getCheckedKeys(),d=a.getHalfCheckedKeys();return e.unshift.apply(e,d),e},j=()=>{const a=m(v);if(!a)return;let e=a.getCheckedNodes(!0),d=[];return e&&e.map(r=>{let p={path:r.path,method:r.method};d.push(p)}),d},ye=()=>{l.openDataScope=!1,O()},_e=a=>{const e=m(k);a!=="2"&&e.setCheckedKeys([])},P=(a,e)=>{if(e=="menu"){let d=l.menuOptions;for(let r=0;r<d.length;r++){const p=m(V);p.store.nodesMap[d[r].menuId].expanded=a}}else if(e=="api"){let d=l.apiOptions;for(let r=0;r<d.length;r++){const p=m(v);p.store.nodesMap[d[r].onlyId].expanded=a}}else if(e=="dept"){let d=l.deptOptions;for(let r=0;r<d.length;r++){const p=m(k);p.store.nodesMap[d[r].id].expanded=a}}},U=(a,e)=>{e=="menu"?m(V).setCheckedNodes(a?l.menuOptions:[]):e=="api"?m(v).setCheckedNodes(a?l.apiOptions:[]):e=="dept"&&m(k).setCheckedNodes(a?l.deptOptions:[])};return Ae(()=>{h(),le.getDicts("sys_yes_no").then(a=>{l.statusOptions=a.data.data})}),(a,e)=>{const d=s("el-input"),r=s("el-form-item"),p=s("el-option"),F=s("el-select"),g=s("SvgIcon"),i=s("el-button"),q=s("el-form"),$=s("el-card"),_=s("el-table-column"),be=s("el-switch"),ke=s("el-popover"),he=s("el-table"),Ce=s("el-divider"),Ve=s("el-pagination"),ve=s("el-input-number"),xe=s("el-radio"),Fe=s("el-radio-group"),C=s("el-checkbox"),W=s("el-tree"),H=s("el-tab-pane"),Se=s("el-tabs"),Q=s("el-dialog"),N=D("auth"),we=D("loading"),G=D("drag");return f(),A("div",Te,[o($,{shadow:"always"},{default:n(()=>[o(q,{model:l.queryParams,ref:"queryForm",inline:!0},{default:n(()=>[o(r,{label:"角色名称",prop:"search"},{default:n(()=>[o(d,{placeholder:"角色名称模糊查询",clearable:"",onKeyup:Pe(x,["enter"]),style:{width:"240px"},modelValue:l.queryParams.search,"onUpdate:modelValue":e[0]||(e[0]=t=>l.queryParams.search=t)},null,8,["modelValue"])]),_:1}),o(r,{label:"状态",prop:"status"},{default:n(()=>[o(F,{modelValue:l.queryParams.status,"onUpdate:modelValue":e[1]||(e[1]=t=>l.queryParams.status=t),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:n(()=>[(f(!0),A(E,null,R(l.statusOptions,t=>(f(),b(p,{key:t.dict_value,label:t.dict_label,value:t.dict_value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,null,{default:n(()=>[o(i,{type:"primary",plain:"",onClick:x},{default:n(()=>[o(g,{name:"elementSearch"}),e[25]||(e[25]=u(" 搜索 "))]),_:1}),o(i,{onClick:te},{default:n(()=>[o(g,{name:"elementRefresh"}),e[26]||(e[26]=u(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o($,{class:"box-card"},{header:n(()=>[c("div",Be,[e[29]||(e[29]=c("span",{class:"card-header-text"},"角色列表",-1)),c("div",null,[y((f(),b(i,{type:"primary",plain:"",onClick:ie},{default:n(()=>[o(g,{name:"elementPlus"}),e[27]||(e[27]=u(" 新增 "))]),_:1})),[[N,"system:role:add"]]),y((f(),b(i,{type:"danger",plain:"",disabled:l.multiple,onClick:z},{default:n(()=>[o(g,{name:"elementDelete"}),e[28]||(e[28]=u(" 删除 "))]),_:1},8,["disabled"])),[[N,"system:role:delete"]])])])]),default:n(()=>[y((f(),b(he,{data:l.roleList,onSelectionChange:se},{default:n(()=>[o(_,{type:"selection",width:"55",align:"center"}),o(_,{label:"角色编号",prop:"id"}),o(_,{label:"角色名称",prop:"role_name","show-overflow-tooltip":!0}),o(_,{label:"权限字符",prop:"role_key","show-overflow-tooltip":!0}),o(_,{label:"显示顺序",prop:"sort"}),o(_,{label:"状态",align:"center"},{default:n(t=>[o(be,{modelValue:t.row.status,"onUpdate:modelValue":S=>t.row.status=S,"active-value":"0","inactive-value":"1",onClick:S=>ue(t.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),o(_,{label:"创建时间",align:"center",prop:"create_datetime"},{default:n(t=>[c("span",null,J(m(Ue)(t.row.create_datetime)),1)]),_:1}),o(_,{label:"操作",align:"center",fixed:"right"},{default:n(t=>[o(ke,{placement:"left"},{reference:n(()=>[o(i,{type:"primary",circle:""},{default:n(()=>[o(g,{name:"elementStar"})]),_:1})]),default:n(()=>[c("div",null,[y((f(),b(i,{text:"",type:"primary",onClick:S=>me(t.row)},{default:n(()=>[o(g,{name:"elementEdit"}),e[30]||(e[30]=u(" 修改 "))]),_:2},1032,["onClick"])),[[N,"system:role:edit"]])]),c("div",null,[o(i,{text:"",type:"primary",onClick:S=>pe(t.row)},{default:n(()=>[o(g,{name:"elementCircleCheck"}),e[31]||(e[31]=u(" 数据权限 "))]),_:2},1032,["onClick"])]),c("div",null,[y((f(),b(i,{text:"",type:"primary",onClick:S=>z(t.row)},{default:n(()=>[o(g,{name:"elementDelete"}),e[32]||(e[32]=u(" 删除 "))]),_:2},1032,["onClick"])),[[N,"system:role:delete"]])])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[we,l.loading]]),y(c("div",null,[o(Ce),o(Ve,{background:"",total:l.total,"current-page":l.queryParams.page,"page-size":l.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ae},null,8,["total","current-page","page-size"])],512),[[X,l.total>0]])]),_:1}),o(Q,{title:l.title,modelValue:l.open,"onUpdate:modelValue":e[16]||(e[16]=t=>l.open=t),width:"769px",center:""},{footer:n(()=>[c("span",ze,[o(i,{type:"primary",loading:l.bunLoading,onClick:ce},{default:n(()=>e[37]||(e[37]=[u("确 定")])),_:1},8,["loading"]),o(i,{onClick:ge},{default:n(()=>e[38]||(e[38]=[u("取 消")])),_:1})])]),default:n(()=>[y(c("div",null,null,512),[[G,[".app-container .el-dialog",".app-container .el-dialog__header"]]]),o(q,{ref_key:"roleFormRef",ref:L,model:l.roleForm,rules:l.rules,"label-width":"120px","label-position":"right"},{default:n(()=>[o(r,{label:"角色名称",prop:"role_name"},{default:n(()=>[o(d,{modelValue:l.roleForm.role_name,"onUpdate:modelValue":e[2]||(e[2]=t=>l.roleForm.role_name=t),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),o(r,{label:"权限字符",prop:"role_key"},{default:n(()=>[o(d,{modelValue:l.roleForm.role_key,"onUpdate:modelValue":e[3]||(e[3]=t=>l.roleForm.role_key=t),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),o(r,{label:"角色顺序",prop:"sort"},{default:n(()=>[o(ve,{modelValue:l.roleForm.sort,"onUpdate:modelValue":e[4]||(e[4]=t=>l.roleForm.sort=t),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),o(r,{label:"状态"},{default:n(()=>[o(Fe,{modelValue:l.roleForm.status,"onUpdate:modelValue":e[5]||(e[5]=t=>l.roleForm.status=t)},{default:n(()=>[(f(!0),A(E,null,R(l.statusOptions,t=>(f(),b(xe,{key:t.dict_value,label:t.dict_value},{default:n(()=>[u(J(t.dict_label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"权限设置"},{default:n(()=>[o(Se,{modelValue:l.activeName,"onUpdate:modelValue":e[14]||(e[14]=t=>l.activeName=t)},{default:n(()=>[o(H,{label:"菜单权限",name:"first"},{default:n(()=>[o(C,{modelValue:l.menuExpand,"onUpdate:modelValue":e[6]||(e[6]=t=>l.menuExpand=t),onChange:e[7]||(e[7]=t=>P(t,"menu"))},{default:n(()=>e[33]||(e[33]=[u("展开/折叠 ")])),_:1},8,["modelValue"]),o(C,{modelValue:l.menuNodeAll,"onUpdate:modelValue":e[8]||(e[8]=t=>l.menuNodeAll=t),onChange:e[9]||(e[9]=t=>U(t,"menu"))},{default:n(()=>e[34]||(e[34]=[u("全选/全不选 ")])),_:1},8,["modelValue"]),o(W,{class:"tree-border",data:l.menuOptions,"show-checkbox":"",ref_key:"menuRef",ref:V,"node-key":"menuId","empty-text":"加载中，请稍后",props:{label:"menuName",children:"children"},"default-checked-keys":l.menuCheckedKeys},null,8,["data","default-checked-keys"])]),_:1}),o(H,{label:"API权限",name:"second"},{default:n(()=>[o(C,{modelValue:l.apiExpand,"onUpdate:modelValue":e[10]||(e[10]=t=>l.apiExpand=t),onChange:e[11]||(e[11]=t=>P(t,"api"))},{default:n(()=>e[35]||(e[35]=[u("展开/折叠 ")])),_:1},8,["modelValue"]),o(C,{modelValue:l.apiNodeAll,"onUpdate:modelValue":e[12]||(e[12]=t=>l.apiNodeAll=t),onChange:e[13]||(e[13]=t=>U(t,"api"))},{default:n(()=>e[36]||(e[36]=[u("全选/全不选 ")])),_:1},8,["modelValue"]),o(W,{class:"tree-border",data:l.apiOptions,"show-checkbox":"",ref_key:"apiRef",ref:v,"node-key":"onlyId","empty-text":"加载中，请稍后",props:{children:"children",label:"description"},"default-checked-keys":l.apiCheckedKeys},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"备注"},{default:n(()=>[o(d,{modelValue:l.roleForm.remark,"onUpdate:modelValue":e[15]||(e[15]=t=>l.roleForm.remark=t),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),o(Q,{title:l.title,modelValue:l.openDataScope,"onUpdate:modelValue":e[24]||(e[24]=t=>l.openDataScope=t),width:"769px"},{footer:n(()=>[c("span",Me,[o(i,{type:"primary",onClick:ne},{default:n(()=>e[41]||(e[41]=[u("确 定")])),_:1}),o(i,{onClick:ye},{default:n(()=>e[42]||(e[42]=[u("取 消")])),_:1})])]),default:n(()=>[y(c("div",null,null,512),[[G,[".app-container .el-dialog",".app-container .el-dialog__header"]]]),o(q,{model:l.roleForm,"label-width":"80px"},{default:n(()=>[o(r,{label:"角色名称"},{default:n(()=>[o(d,{modelValue:l.roleForm.role_name,"onUpdate:modelValue":e[17]||(e[17]=t=>l.roleForm.role_name=t),disabled:!0},null,8,["modelValue"])]),_:1}),o(r,{label:"权限字符"},{default:n(()=>[o(d,{modelValue:l.roleForm.role_key,"onUpdate:modelValue":e[18]||(e[18]=t=>l.roleForm.role_key=t),disabled:!0},null,8,["modelValue"])]),_:1}),o(r,{label:"权限范围"},{default:n(()=>[o(F,{modelValue:l.roleForm.data_scope,"onUpdate:modelValue":e[19]||(e[19]=t=>l.roleForm.data_scope=t),onChange:_e},{default:n(()=>[(f(!0),A(E,null,R(l.dataScopeOptions,t=>(f(),b(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y(o(r,{label:"数据权限"},{default:n(()=>[o(C,{modelValue:l.deptExpand,"onUpdate:modelValue":e[20]||(e[20]=t=>l.deptExpand=t),onChange:e[21]||(e[21]=t=>P(t,"dept"))},{default:n(()=>e[39]||(e[39]=[u("展开/折叠 ")])),_:1},8,["modelValue"]),o(C,{modelValue:l.deptNodeAll,"onUpdate:modelValue":e[22]||(e[22]=t=>l.deptNodeAll=t),onChange:e[23]||(e[23]=t=>U(t,"dept"))},{default:n(()=>e[40]||(e[40]=[u("全选/全不选 ")])),_:1},8,["modelValue"]),o(W,{class:"tree-border",data:l.deptOptions,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:k,"node-key":"id","empty-text":"加载中，请稍后",props:{label:"dept_name",children:"children"}},null,8,["data"])]),_:1},512),[[X,l.roleForm.data_scope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Xe as default};
