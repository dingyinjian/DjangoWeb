import{d as G,g as H,I as C,D as W,k as X,m as Y,Q as Z,r as i,a4 as D,o as r,a as v,h as e,w as n,a5 as ee,F as te,e as le,i as s,b as f,y as _,f as u,t as y,a0 as ne,aa as ae,z as oe,O as V,N as j}from"./index.1764234947110.js";import{c as re,d as ie,r as de}from"./job.1764234947110.js";import{_ as se}from"./editModule.vue_vue_type_script_setup_true_lang.17642349471106.js";import{_ as ue}from"./cronLogs.vue_vue_type_script_setup_true_lang.1764234947110.js";import"./cronExpression.1764234947110.js";const pe={class:"app-container"},me={class:"card-header"},ce={key:0},fe={key:1},he=G({__name:"index",setup(_e){const{proxy:x}=H(),h=C(),S=C();C(null),W();const l=X({loading:!0,ids:[],single:!0,multiple:!0,title:"",tableData:[],total:0,open:!1,modelForm:{},enabledOptions:[{dictValue:!1,dictLabel:"停止"},{dictValue:!0,dictLabel:"开启"}],queryParams:{page:1,pageSize:10,name:void 0,enabled:void 0},intervalList:[{id:"days",name:"天"},{id:"hours",name:"小时"},{id:"minutes",name:"分钟"},{id:"seconds",name:"秒"},{id:"microseconds",name:"微秒"}]}),p=()=>{l.loading=!0,re(l.queryParams).then(a=>{l.tableData=a.data.data,l.total=a.data.total,l.loading=!1})},z=()=>{l.queryParams.name=void 0,l.queryParams.enabled=void 0,p()},L=()=>{l.title="添加定时任务",h.value.openDialog({})},M=a=>{l.title="修改定时任务",h.value.openDialog(a)},R=a=>{l.title="任务日志",S.value.openDialog(a)},q=a=>{const t=a.id||l.ids;V({message:'是否确认删除定时任务编号为"'+t+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return ie(t).then(()=>{p(),j.success("删除成功")})})},E=a=>{l.ids=a.map(t=>t.id),l.single=a.length!=1,l.multiple=!a.length},T=a=>{l.queryParams.pageSize=a,p()},O=a=>{l.queryParams.page=a,p()},$=a=>{let t=a.enabled==!0?"停止":"启动";V({message:"确认要立即"+t+'"'+a.name+'"任务吗?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.enabled==!1?a.enabled=!0:a.enabled=!1,de(a.id,a.enabled).then(B=>{p()})}).then(()=>{j({message:t+"执行成功",type:"success"})})};return Y(()=>{p(),x.mittBus.on("onEditJobModule",a=>{p()})}),Z(()=>{x.mittBus.off("onEditJobModule")}),(a,t)=>{const B=i("el-input"),k=i("el-form-item"),F=i("el-option"),I=i("el-select"),m=i("SvgIcon"),c=i("el-button"),J=i("el-form"),P=i("el-card"),d=i("el-table-column"),w=i("el-tag"),N=i("el-popover"),Q=i("el-table"),U=i("el-divider"),K=i("el-pagination"),g=D("auth"),A=D("loading");return r(),v("div",pe,[e(P,{shadow:"always"},{default:n(()=>[e(J,{model:l.queryParams,ref:"queryForm",inline:!0,"label-width":"68px"},{default:n(()=>[e(k,{label:"任务名称",prop:"jobName"},{default:n(()=>[e(B,{placeholder:"请输入任务名称模糊查询",clearable:"",onKeyup:ee(p,["enter"]),style:{width:"240px"},modelValue:l.queryParams.name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.queryParams.name=o)},null,8,["modelValue"])]),_:1}),e(k,{label:"任务状态",prop:"enabled"},{default:n(()=>[e(I,{modelValue:l.queryParams.enabled,"onUpdate:modelValue":t[1]||(t[1]=o=>l.queryParams.enabled=o),placeholder:"请选择任务状态",clearable:"",style:{width:"240px"}},{default:n(()=>[(r(!0),v(te,null,le(l.enabledOptions,o=>(r(),u(F,{key:o.dictValue,label:o.dictLabel,value:o.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(k,null,{default:n(()=>[e(c,{type:"primary",plain:"",onClick:p},{default:n(()=>[e(m,{name:"elementSearch"}),t[2]||(t[2]=s(" 搜索 "))]),_:1}),e(c,{onClick:z},{default:n(()=>[e(m,{name:"elementRefresh"}),t[3]||(t[3]=s(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,{class:"box-card"},{header:n(()=>[f("div",me,[t[6]||(t[6]=f("span",{class:"card-header-text"},"定时任务列表",-1)),f("div",null,[_((r(),u(c,{type:"primary",plain:"",onClick:L},{default:n(()=>[e(m,{name:"elementPlus"}),t[4]||(t[4]=s(" 新增 "))]),_:1})),[[g,"tool:job:add"]]),_((r(),u(c,{type:"danger",plain:"",disabled:l.multiple,onClick:q},{default:n(()=>[e(m,{name:"elementDelete"}),t[5]||(t[5]=s(" 删除 "))]),_:1},8,["disabled"])),[[g,"tool:job:delete"]])])])]),default:n(()=>[_((r(),u(Q,{data:l.tableData,onSelectionChange:E},{default:n(()=>[e(d,{type:"selection",width:"55",align:"center"}),e(d,{label:"任务编号",align:"center",prop:"id"}),e(d,{label:"任务名称",align:"center",prop:"name",width:"160","show-overflow-tooltip":!0}),e(d,{label:"任务类型",align:"center",prop:"type"},{default:n(o=>[s(y(o.row.type==0?"间隔任务":"周期任务"),1)]),_:1}),e(d,{label:"已运行次数",align:"center",prop:"total_run_count",width:"120","show-overflow-tooltip":!0}),e(d,{label:"任务参数",align:"center",prop:"kwargs",width:"120","show-overflow-tooltip":!0}),e(d,{label:"一次性任务",align:"center",prop:"total_run_count",width:"120","show-overflow-tooltip":!0},{default:n(o=>[o.row.one_off?(r(),u(w,{key:0,type:"success"},{default:n(()=>t[7]||(t[7]=[s("是")])),_:1})):(r(),u(w,{key:1,type:"info"},{default:n(()=>t[8]||(t[8]=[s("否")])),_:1}))]),_:1}),e(d,{label:"执行状态",align:"center",width:"120","show-overflow-tooltip":!0},{default:n(o=>[o.row.enabled?(r(),u(w,{key:0},{default:n(()=>t[9]||(t[9]=[s("正常")])),_:1})):(r(),u(w,{key:1,type:"danger"},{default:n(()=>t[10]||(t[10]=[s("停止")])),_:1}))]),_:1}),e(d,{label:"执行方法",align:"center",prop:"task",width:"200","show-overflow-tooltip":!0}),e(d,{label:"执行时间",align:"center",width:"120","show-overflow-tooltip":!0},{default:n(o=>[o.row.type?(r(),v("span",ce,y(o.row.crontab),1)):(r(),v("span",fe,y("间隔"+o.row.interval.every+l.intervalList.filter(b=>o.row.interval.period===b.id)[0].name),1))]),_:1}),e(d,{label:"备注",align:"center",prop:"description",width:"160","show-overflow-tooltip":!0}),e(d,{label:"更新时间",align:"center",prop:"date_changed",width:"180"},{default:n(o=>[f("span",null,y(ne(ae)(o.row.date_changed)),1)]),_:1}),e(d,{label:"操作",align:"center",width:"120",fixed:"right"},{default:n(o=>[e(N,{placement:"left"},{reference:n(()=>[e(c,{type:"primary",circle:""},{default:n(()=>[e(m,{name:"elementStar"})]),_:1})]),default:n(()=>[f("div",null,[_((r(),u(c,{text:"",type:"primary",onClick:b=>$(o.row)},{default:n(()=>[e(m,{name:"elementSwitchButton"}),s(" "+y(o.row.enabled==!0?"停止":"启动"),1)]),_:2},1032,["onClick"])),[[g,"tool:job:run"]])]),f("div",null,[_((r(),u(c,{text:"",type:"primary",onClick:b=>M(o.row)},{default:n(()=>[e(m,{name:"elementEdit"}),t[11]||(t[11]=s(" 编辑 "))]),_:2},1032,["onClick"])),[[g,"tool:job:edit"]])]),f("div",null,[_((r(),u(c,{text:"",type:"primary",onClick:b=>R(o.row)},{default:n(()=>[e(m,{name:"elementTickets"}),t[12]||(t[12]=s(" 日志 "))]),_:2},1032,["onClick"])),[[g,"tool:job:log"]])]),f("div",null,[_((r(),u(c,{text:"",type:"primary",onClick:b=>q(o.row)},{default:n(()=>[e(m,{name:"elementDelete"}),t[13]||(t[13]=s(" 删除 "))]),_:2},1032,["onClick"])),[[g,"tool:job:delete"]])])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[A,l.loading]]),_(f("div",null,[e(U),e(K,{background:"",total:l.total,"current-page":l.queryParams.page,"page-size":l.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:O},null,8,["total","current-page","page-size"])],512),[[oe,l.total>0]])]),_:1}),e(se,{ref_key:"editModuleRef",ref:h,title:l.title},null,8,["title"]),e(ue,{ref_key:"cronLogsRef",ref:S,title:l.title},null,8,["title"])])}}});export{he as default};
