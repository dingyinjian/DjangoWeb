import{d as Y,g as Z,I as ee,k as le,r as n,a4 as N,o as s,a as g,h as l,w as a,y as V,i as c,t as te,b as _,F,e as w,f as d,A as h,a5 as ae,z as oe,aq as re,a0 as ne,N as se}from"./index.1764234947110.js";import{a as ue}from"./notice.1764234947110.js";import{d as de}from"./dept.1764234947110.js";import{g as ie}from"./role.1764234947110.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_name_wngEditor_lang.1764234947110.js";const me={class:"system-notice-container"},ge={style:{"font-size":"large"}},ce={class:"dialog-footer"},_e={class:"card-header"},Fe=Y({__name:"editModule",props:{title:{type:String,default:()=>""}},setup(Q,{expose:R}){const{proxy:S}=Z(),k=ee(null),e=le({isShowDialog:!1,loading:!1,userLoading:!1,dialogVisible:!1,queryParams:{page:1,pageSize:10,search:void 0,status:void 0,dept:void 0},userQueryParams:{page:1,pageSize:10,search:void 0},single:!0,multiple:!0,userSelectIds:[],ruleForm:{id:0,title:"",target_type:"",content:"",remark:"",target_user:[],target_role:[],target_dept:[]},noticeTypeOptions:[],deptOptions:[],roleOptions:[],userOptions:{data:[],total:0},ruleRules:{title:[{required:!0,message:"信息名称不能为空",trigger:"blur"}],target_type:[{required:!0,message:"信息类型不能为空",trigger:"blur"}]}}),q=r=>{e.ruleForm=JSON.parse(JSON.stringify(r)),e.isShowDialog=!0,e.loading=!1,S.getDicts("sys_notice_type").then(t=>{e.noticeTypeOptions=t.data.data}),B(),H()},I=()=>{e.dialogVisible=!0,f()},L=r=>{e.queryParams.pageSize=r,f()},T=r=>{e.queryParams.page=r,f()},C=async()=>{e.userQueryParams.page=1,await f()},f=async()=>{e.userLoading=!0,re(e.userQueryParams).then(r=>{r.code!=200&&(e.userLoading=!1),e.userOptions.data=r.data.data,e.userOptions.total=r.data.total,e.userLoading=!1})},A=r=>{e.ruleForm.target_user=r.id||e.userSelectIds,e.dialogVisible=!1},B=async()=>{de().then(r=>{e.deptOptions=r.data})},H=async()=>{ie().then(r=>{e.roleOptions=r.data.roles})},E=r=>{e.userSelectIds=r.map(t=>t.id),e.single=r.length!=1,e.multiple=!r.length},O=r=>{S.mittBus.emit("onEditNoticeModule",r),e.isShowDialog=!1},M=()=>{O()},J=()=>{const r=ne(k);r&&r.validate(t=>{if(t&&(e.loading=!0,!(e.ruleForm.id!=null&&e.ruleForm.id!=0))){if(e.ruleForm.target_type==="2"){const i=e.ruleForm.target_dept.flat();e.ruleForm.target_dept=[...new Set(i)]}ue(e.ruleForm).then(()=>{se.success("新增成功"),e.loading=!1,O(e.ruleForm)})}})};return R({openDialog:q}),(r,t)=>{const i=n("el-input"),u=n("el-form-item"),p=n("el-col"),x=n("el-row"),b=n("el-option"),v=n("el-select"),K=n("el-cascader"),U=n("el-form"),y=n("el-button"),z=n("el-dialog"),D=n("SvgIcon"),P=n("el-card"),m=n("el-table-column"),j=n("el-table"),W=n("el-divider"),$=n("el-pagination"),G=N("drag"),X=N("loading");return s(),g("div",me,[l(z,{modelValue:e.isShowDialog,"onUpdate:modelValue":t[7]||(t[7]=o=>e.isShowDialog=o),width:"769px",center:""},{header:a(()=>[V((s(),g("div",ge,[c(te(Q.title),1)])),[[G,[".system-notice-container .el-dialog",".system-notice-container .el-dialog__header"]]])]),footer:a(()=>[_("span",ce,[l(y,{onClick:M},{default:a(()=>t[10]||(t[10]=[c("取 消")])),_:1}),l(y,{type:"primary",onClick:J,loading:e.loading},{default:a(()=>t[11]||(t[11]=[c("确 定")])),_:1},8,["loading"])])]),default:a(()=>[l(U,{model:e.ruleForm,rules:e.ruleRules,ref_key:"ruleFormRef",ref:k,"label-width":"100px"},{default:a(()=>[l(x,{class:"mb20"},{default:a(()=>[l(p,{span:24},{default:a(()=>[l(u,{label:"信息标题"},{default:a(()=>[l(i,{modelValue:e.ruleForm.title,"onUpdate:modelValue":t[0]||(t[0]=o=>e.ruleForm.title=o),placeholder:"请输入信息标题"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(x,{class:"mb20"},{default:a(()=>[l(p,{span:12},{default:a(()=>[l(u,{label:"信息类型"},{default:a(()=>[l(v,{modelValue:e.ruleForm.target_type,"onUpdate:modelValue":t[1]||(t[1]=o=>e.ruleForm.target_type=o),placeholder:"请选择"},{default:a(()=>[(s(!0),g(F,null,w(e.noticeTypeOptions,o=>(s(),d(b,{key:o.dict_value,label:o.dict_label,value:o.dict_value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{span:12},{default:a(()=>[e.ruleForm.target_type==="0"?(s(),d(u,{key:0,label:"通知用户"},{default:a(()=>[l(v,{modelValue:e.ruleForm.target_user,"onUpdate:modelValue":t[2]||(t[2]=o=>e.ruleForm.target_user=o),multiple:"",clearable:"",placeholder:"请选择用户",onClick:I},{default:a(()=>[(s(!0),g(F,null,w(e.userOptions.data,o=>(s(),d(b,{key:o.id,label:o.username,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):h("",!0),e.ruleForm.target_type==="1"?(s(),d(u,{key:1,label:"通知角色"},{default:a(()=>[l(v,{modelValue:e.ruleForm.target_role,"onUpdate:modelValue":t[3]||(t[3]=o=>e.ruleForm.target_role=o),multiple:"",clearable:"",placeholder:"请选择角色"},{default:a(()=>[(s(!0),g(F,null,w(e.roleOptions,o=>(s(),d(b,{key:o.id,label:o.role_name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):h("",!0),e.ruleForm.target_type==="2"?(s(),d(u,{key:2,label:"通知部门"},{default:a(()=>[l(K,{modelValue:e.ruleForm.target_dept,"onUpdate:modelValue":t[4]||(t[4]=o=>e.ruleForm.target_dept=o),options:e.deptOptions,class:"w100",props:{label:"dept_name",value:"id",multiple:!0},clearable:"",placeholder:"选择通知部门","show-all-levels":!1},null,8,["modelValue","options"])]),_:1})):h("",!0)]),_:1})]),_:1}),l(p,{span:24},{default:a(()=>[l(u,{label:"通知内容",prop:"content"},{default:a(()=>[l(pe,{"get-html":e.ruleForm.content,"onUpdate:getHtml":t[5]||(t[5]=o=>e.ruleForm.content=o)},null,8,["get-html"])]),_:1})]),_:1}),l(p,{span:24},{default:a(()=>[l(u,{label:"备注",prop:"content"},{default:a(()=>[l(i,{modelValue:e.ruleForm.remark,"onUpdate:modelValue":t[6]||(t[6]=o=>e.ruleForm.remark=o),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入备注..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(z,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=o=>e.dialogVisible=o)},{default:a(()=>[l(P,{shadow:"always"},{default:a(()=>[l(U,{model:e.userQueryParams,ref:"queryForm",inline:!0,"label-width":"78px"},{default:a(()=>[l(u,{label:"用户名称",prop:"username"},{default:a(()=>[l(i,{placeholder:"用户名称模糊查询",clearable:"",onKeyup:ae(C,["enter"]),style:{width:"240px"},modelValue:e.userQueryParams.search,"onUpdate:modelValue":t[8]||(t[8]=o=>e.userQueryParams.search=o)},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(y,{type:"primary",plain:"",onClick:C},{default:a(()=>[l(D,{name:"elementSearch"}),t[12]||(t[12]=c(" 搜索 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(P,{class:"box-card"},{header:a(()=>[_("div",_e,[t[14]||(t[14]=_("span",{class:"card-header-text"},"用户列表",-1)),_("div",null,[l(y,{type:"primary",plain:"",disabled:e.multiple,onClick:A},{default:a(()=>[l(D,{name:"elementPlus"}),t[13]||(t[13]=c(" 确定 "))]),_:1},8,["disabled"])])])]),default:a(()=>[V((s(),d(j,{data:e.userOptions.data,stripe:"",onSelectionChange:E,width:"500px",center:""},{default:a(()=>[l(m,{type:"selection",width:"45",align:"center"}),l(m,{label:"用户编号",align:"center",prop:"id"}),l(m,{label:"用户名",prop:"username","show-overflow-tooltip":""}),l(m,{prop:"phone",label:"手机","show-overflow-tooltip":""}),l(m,{prop:"dept_name",label:"部门名称","show-overflow-tooltip":""})]),_:1},8,["data"])),[[X,e.userLoading]]),V(_("div",null,[l(W),l($,{background:"",total:e.userOptions.total,"page-sizes":[10,20,30],"current-page":e.userQueryParams.page,"page-size":e.userQueryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:L,onCurrentChange:T},null,8,["total","current-page","page-size"])],512),[[oe,e.userOptions.total>0]])]),_:1})]),_:1},8,["modelValue"])])}}});export{Fe as _};
