import{d as $,g as K,I as j,k as L,m as H,Q as J,r,a4 as q,o as i,a as b,h as t,w as l,a5 as W,F as S,e as V,i as p,b as _,y as g,f as c,t as D,A as X,z as Y,O as Z,N as ee}from"./index.1764234947110.js";import{g as te,l as ae,d as le}from"./api.1764234947110.js";import{_ as oe}from"./editModule.vue_vue_type_script_setup_true_lang.1764234947110.js";const ne={class:"app-container"},re={class:"card-header"},ue=$({__name:"index",setup(ie){const{proxy:h}=K(),v=j(),e=L({loading:!0,ids:[],single:!0,multiple:!0,title:"",tableData:[],total:0,methodOptions:[],apiGroups:[],queryParams:{page:1,pageSize:10,method:void 0,api_group:void 0,search:void 0}}),s=()=>{e.loading=!0,ae(e.queryParams).then(n=>{e.tableData=n.data.data,e.total=n.data.total,e.loading=!1})},A=()=>{e.queryParams.method=void 0,e.queryParams.api_group=void 0,e.queryParams.search=void 0,s()},B=()=>{e.title="添加Api参数",v.value.openDialog({})},z=n=>{e.title="修改Api参数",v.value.openDialog(n)},w=n=>{const a=n.id||e.ids;Z({message:'是否确认删除配置参数编号为"'+a+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return le(a).then(()=>{s(),ee.success("删除成功")})})},M=n=>{e.ids=n.map(a=>a.id),e.single=n.length!=1,e.multiple=!n.length},E=n=>{e.queryParams.pageSize=n,s()},I=n=>{e.queryParams.page=n,s()};return H(()=>{s(),h.getDicts("sys_method_api").then(n=>{e.methodOptions=n.data.data}),h.mittBus.on("onEditApiModule",n=>{s()}),te().then(n=>{e.apiGroups=n.data.api_groups})}),J(()=>{h.mittBus.off("onEditApiModule")}),(n,a)=>{const O=r("el-input"),f=r("el-form-item"),C=r("el-option"),x=r("el-select"),u=r("SvgIcon"),m=r("el-button"),N=r("el-form"),P=r("el-card"),d=r("el-table-column"),k=r("el-tag"),G=r("el-popover"),R=r("el-table"),T=r("el-divider"),U=r("el-pagination"),y=q("auth"),F=q("loading");return i(),b("div",ne,[t(P,{shadow:"always"},{default:l(()=>[t(N,{model:e.queryParams,ref:"queryForm",inline:!0},{default:l(()=>[t(f,{label:"关键词",prop:"search"},{default:l(()=>[t(O,{placeholder:"Api路径 简介模糊查询",clearable:"",onKeyup:W(s,["enter"]),style:{width:"240px"},modelValue:e.queryParams.search,"onUpdate:modelValue":a[0]||(a[0]=o=>e.queryParams.search=o)},null,8,["modelValue"])]),_:1}),t(f,{label:"分组",prop:"api_group"},{default:l(()=>[t(x,{modelValue:e.queryParams.api_group,"onUpdate:modelValue":a[1]||(a[1]=o=>e.queryParams.api_group=o),placeholder:"分组查询",filterable:"",clearable:"",style:{width:"240px"}},{default:l(()=>[(i(!0),b(S,null,V(e.apiGroups,o=>(i(),c(C,{key:o.api_group,label:o.api_group,value:o.api_group},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"方法",prop:"method"},{default:l(()=>[t(x,{modelValue:e.queryParams.method,"onUpdate:modelValue":a[2]||(a[2]=o=>e.queryParams.method=o),placeholder:"方法",clearable:"",style:{width:"240px"}},{default:l(()=>[(i(!0),b(S,null,V(e.methodOptions,o=>(i(),c(C,{key:o.dict_value,label:o.dict_label,value:o.dict_value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(m,{type:"primary",plain:"",onClick:s},{default:l(()=>[t(u,{name:"elementSearch"}),a[3]||(a[3]=p(" 搜索 "))]),_:1}),t(m,{onClick:A},{default:l(()=>[t(u,{name:"elementRefresh"}),a[4]||(a[4]=p(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(P,{class:"box-card"},{header:l(()=>[_("div",re,[a[7]||(a[7]=_("span",{class:"card-header-text"},"API列表",-1)),_("div",null,[g((i(),c(m,{type:"primary",plain:"",onClick:B},{default:l(()=>[t(u,{name:"elementPlus"}),a[5]||(a[5]=p(" 新增 "))]),_:1})),[[y,"system:api:add"]]),g((i(),c(m,{type:"danger",plain:"",disabled:e.multiple,onClick:w},{default:l(()=>[t(u,{name:"elementDelete"}),a[6]||(a[6]=p(" 删除 "))]),_:1},8,["disabled"])),[[y,"system:api:delete"]])])])]),default:l(()=>[g((i(),c(R,{data:e.tableData,onSelectionChange:M},{default:l(()=>[t(d,{type:"selection",width:"55",align:"center"}),t(d,{label:"id",align:"center",prop:"id"}),t(d,{label:"路径",align:"center",prop:"path","show-overflow-tooltip":!0}),t(d,{label:"分组",align:"center",prop:"api_group"}),t(d,{label:"激活数据权限",align:"center",prop:"enable_datasource"},{default:l(o=>[t(k,{type:o.row.enable_datasource==="0"?"success":"danger","disable-transitions":""},{default:l(()=>[p(D(o.row.enable_datasource==="0"?"需要":"不需要"),1)]),_:2},1032,["type"])]),_:1}),t(d,{label:"简介",align:"center",prop:"description"}),t(d,{label:"请求",align:"center",prop:"method","show-overflow-tooltip":!0},{default:l(o=>[t(k,{type:"success"},{default:l(()=>[p(D(o.row.method),1)]),_:2},1024)]),_:1}),t(d,{label:"操作",align:"center",width:"200","class-name":"medium-padding fixed-width",fixed:"right"},{default:l(o=>[t(G,{placement:"left"},{reference:l(()=>[t(m,{type:"primary",circle:""},{default:l(()=>[t(u,{name:"elementStar"})]),_:1})]),default:l(()=>[_("div",null,[g((i(),c(m,{text:"",type:"primary",onClick:Q=>z(o.row)},{default:l(()=>[t(u,{name:"elementEdit"}),a[8]||(a[8]=p(" 修改 "))]),_:2},1032,["onClick"])),[[y,"system:api:edit"]])]),_("div",null,[o.row.parentId!=0?g((i(),c(m,{key:0,text:"",type:"primary",onClick:Q=>w(o.row)},{default:l(()=>[t(u,{name:"elementDelete"}),a[9]||(a[9]=p(" 删除 "))]),_:2},1032,["onClick"])),[[y,"system:api:delete"]]):X("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[F,e.loading]]),g(_("div",null,[t(T),t(U,{background:"",total:e.total,"current-page":e.queryParams.page,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:I},null,8,["total","current-page","page-size"])],512),[[Y,e.total>0]])]),_:1}),t(oe,{ref_key:"editModuleRef",ref:v,title:e.title},null,8,["title"])])}}});export{ue as default};
